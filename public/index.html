<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .hidden { display: none; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input, select, button { padding: 8px; margin-right: 10px; }
        button { background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        .error { 
            color: #721c24; 
            margin: 15px 0; 
            padding: 12px 15px; 
            background-color: #f8d7da; 
            border: 1px solid #f5c6cb; 
            border-radius: 8px; 
            font-weight: 500; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #dc3545;
            font-size: 14px;
            display: block;
            position: relative;
        }
        .error:before {
            content: "⚠️ ";
            margin-right: 8px;
        }
        .error h3 { color: red; }
        .error td { color: red; font-style: italic; }
        .success { 
            color: #155724; 
            margin: 15px 0; 
            padding: 12px 15px; 
            background-color: #d4edda; 
            border: 1px solid #c3e6cb; 
            border-radius: 8px; 
            font-weight: 500; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #28a745;
            font-size: 14px;
            display: block;
            position: relative;
        }
        .success:before {
            content: "✅ ";
            margin-right: 8px;
        }
        .error:empty, .success:empty {
            display: none;
            margin: 0;
            padding: 0;
        }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .nav-button { margin: 5px; padding: 10px 15px; }
        .summary { background: #f8f9fa; padding: 15px; margin: 20px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login/Register Section -->
        <div id="auth-section">
            <h2>Login / Register</h2>
            
            <div id="login-form">
                <h3>Login</h3>
                <div class="form-group">
                    <label>Username:</label>
                    <input type="text" id="login-username" required placeholder="Enter your username (e.g., john_doe)">
                    <small style="color: #666; font-size: 12px;">
                        Username: letters, numbers, and underscores only
                    </small>
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="login-password" required placeholder="Enter your password">
                </div>
                <button onclick="login()">Login</button>
                <button onclick="showRegister()">Register</button>
                <button onclick="showForgotUsername()" style="background: #17a2b8;">Forgot Username?</button>
                <button onclick="showForgotPassword()" style="background: #6c757d;">Forgot Password?</button>
            </div>
            
            <div id="register-form" class="hidden">
                <h3>Register</h3>
                <div class="form-group">
                    <label>Full Name:</label>
                    <input type="text" id="register-name" required>
                </div>
                <div class="form-group">
                    <label>Username:</label>
                    <input type="text" id="register-username" required>
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="register-email" required>
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="register-password" required>
                    <small style="color: #666; font-size: 12px;">
                        8-16 characters with at least one uppercase, one lowercase, one number, and one special character (_, -, or &)
                    </small>
                </div>
                <div class="form-group">
                    <label>Confirm Password:</label>
                    <input type="password" id="register-confirm-password" required>
                </div>
                <div class="form-group">
                    <label>Security Question:</label>
                    <select id="register-security-question" required>
                        <option value="">Select a security question</option>
                        <option value="pet">What was the name of your first pet?</option>
                        <option value="school">What was the name of your elementary school?</option>
                        <option value="city">In what city were you born?</option>
                        <option value="mother">What is your mother's maiden name?</option>
                        <option value="car">What was the make of your first car?</option>
                        <option value="street">What street did you grow up on?</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Security Answer:</label>
                    <input type="text" id="register-security-answer" required placeholder="Enter your answer">
                </div>
                <button onclick="register()">Register</button>
                <button onclick="showLogin()">Back to Login</button>
            </div>
            
            <!-- Forgot Username Form -->
            <div id="forgot-username-form" class="hidden">
                <h3>Forgot Username</h3>
                <p>Enter your email address to retrieve your username:</p>
                <div class="form-group">
                    <label>Email Address:</label>
                    <input type="email" id="forgot-username-email-input" required placeholder="Enter your email address">
                </div>
                <button onclick="forgotUsername()">Find Username</button>
                <button onclick="showLogin()">Back to Login</button>
            </div>
            
            <div id="forgot-password-form" class="hidden">
                <h3>Forgot Password</h3>
                <p>Enter your username or email address to reset your password:</p>
                <div class="form-group">
                    <label>Username or Email:</label>
                    <input type="text" id="forgot-username-email" required placeholder="Enter username (e.g., john_doe) or email (e.g., john@example.com)">
                    <small style="color: #666; font-size: 12px;">
                        Username: letters, numbers, and underscores only<br>
                        Email: valid email address format
                    </small>
                </div>
                <button onclick="requestPasswordReset()">Continue</button>
                <button onclick="showLogin()">Back to Login</button>
            </div>
            
            <div id="reset-password-form" class="hidden">
                <h3>Reset Password</h3>
                <p>Hello, <span id="reset-user-name"></span>!</p>
                <p><strong>Security Question:</strong> <span id="reset-security-question"></span></p>
                <div class="form-group">
                    <label>Security Answer:</label>
                    <input type="text" id="reset-security-answer" required placeholder="Enter your security answer">
                </div>
                <div class="form-group">
                    <label>New Password:</label>
                    <input type="password" id="reset-new-password" required>
                    <small style="color: #666; font-size: 12px;">
                        8-16 characters with at least one uppercase, one lowercase, one number, and one special character (_, -, or &)
                    </small>
                </div>
                <div class="form-group">
                    <label>Confirm New Password:</label>
                    <input type="password" id="reset-confirm-password" required>
                </div>
                <button onclick="resetPassword()">Reset Password</button>
                <button onclick="showLogin()">Back to Login</button>
            </div>
            
            <div id="auth-message" class="error"></div>
        </div>

        <!-- Welcome Section -->
        <div id="welcome-section" class="hidden">
            <h2>Welcome, <span id="user-name"></span>!</h2>
            <p><em>"A penny saved is a penny earned." - Benjamin Franklin</em></p>
            
            <h3>Choose Your Tracking Option:</h3>
            <button onclick="setTrackingOption('income')">Income Only</button>
            <button onclick="setTrackingOption('expenses')">Expenses Only</button>
            <button onclick="setTrackingOption('both')">Both Income & Expenses</button>
        </div>

        <!-- Main Application -->
        <div id="main-app" class="hidden">
            <div id="nav-bar">
                <button class="nav-button" onclick="showSection('setup')">Setup</button>
                <button class="nav-button" onclick="showSection('transactions')">Transactions</button>
                <button class="nav-button" onclick="showSection('summary')">Monthly Summary</button>
                <button class="nav-button" onclick="logout()">Logout</button>
            </div>

            <!-- Setup Section -->
            <div id="setup-section">
                <h2>Account Setup</h2>
                
                <!-- Bank Setup -->
                <div id="bank-setup">
                    <h3>Bank Setup</h3>
                    <div class="form-group">
                        <label>Bank Name:</label>
                        <input type="text" id="bank-name" placeholder="Enter bank name">
                        <label>Initial Balance:</label>
                        <input type="number" id="bank-balance" placeholder="0.00" step="0.01">
                        <button onclick="addBank()">Add Bank</button>
                    </div>
                    <div id="bank-message" class="error"></div>
                    <div id="banks-list"></div>
                </div>

                <!-- Credit Card Setup -->
                <div id="credit-card-setup">
                    <h3>Credit Card Setup</h3>
                    <div class="form-group">
                        <label>Card Name:</label>
                        <input type="text" id="cc-name" placeholder="Enter card name">
                        <label>Credit Limit:</label>
                        <input type="number" id="cc-limit" placeholder="0.00" step="0.01">
                        <button onclick="addCreditCard()">Add Credit Card</button>
                    </div>
                    <div id="credit-card-message" class="error"></div>
                    <div id="credit-cards-list"></div>
                </div>

                <!-- Cash Balance Setup -->
                <div id="cash-setup">
                    <h3>Cash Balance</h3>
                    <div class="form-group">
                        <label>Cash Balance:</label>
                        <input type="number" id="cash-balance" placeholder="0.00" step="0.01">
                        <button onclick="setCashBalance()">Set Cash Balance</button>
                    </div>
                    <div id="cash-message" class="error"></div>
                    <div id="cash-display"></div>
                </div>
            </div>

            <!-- Transactions Section -->
            <div id="transactions-section" class="hidden">
                <h2>Transactions</h2>
                
                <!-- Income Form -->
                <div id="income-form">
                    <h3>Add Income</h3>
                    <div class="form-group">
                        <label>Source:</label>
                        <input type="text" id="income-source" placeholder="Salary, Freelance, etc.">
                        <label>Amount:</label>
                        <input type="number" id="income-amount" placeholder="0.00" step="0.01">
                        <label>Credited To:</label>
                        <select id="income-credited-to">
                            <option value="cash">Cash</option>
                        </select>
                        <label>Date:</label>
                        <input type="date" id="income-date">
                        <button onclick="addIncome()">Add Income</button>
                    </div>
                </div>

                <!-- Expense Form -->
                <div id="expense-form">
                    <h3>Add Expense</h3>
                    <div class="form-group">
                        <label>Title:</label>
                        <input type="text" id="expense-title" placeholder="Groceries, Rent, etc.">
                        <label>Amount:</label>
                        <input type="number" id="expense-amount" placeholder="0.00" step="0.01">
                        <label>Payment Method:</label>
                        <select id="expense-payment-method">
                            <option value="cash">Cash</option>
                        </select>
                        <label>Date:</label>
                        <input type="date" id="expense-date">
                        <button onclick="addExpense()">Add Expense</button>
                    </div>
                </div>

                <div id="transactions-message" class="error"></div>

                <!-- Transactions History -->
                <div id="transactions-history">
                    <!-- Income History -->
                    <div id="income-history">
                        <h3>Income History</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Source</th>
                                    <th>Amount</th>
                                    <th>Credited To</th>
                                </tr>
                            </thead>
                            <tbody id="income-table-body"></tbody>
                        </table>
                    </div>

                    <!-- Expense History -->
                    <div id="expense-history">
                        <h3>Expense History</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Title</th>
                                    <th>Amount</th>
                                    <th>Payment Method</th>
                                </tr>
                            </thead>
                            <tbody id="expense-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Monthly Summary Section -->
            <div id="summary-section" class="hidden">
                <h2>Monthly Summary</h2>
                
                <div class="form-group">
                    <label>Month:</label>
                    <select id="summary-month">
                        <option value="1">January</option>
                        <option value="2">February</option>
                        <option value="3">March</option>
                        <option value="4">April</option>
                        <option value="5">May</option>
                        <option value="6">June</option>
                        <option value="7">July</option>
                        <option value="8">August</option>
                        <option value="9">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>
                    <label>Year:</label>
                    <select id="summary-year"></select>
                    <button onclick="loadMonthlySummary()">Load Summary</button>
                </div>

                <div id="summary-display">
                    <p style="color: #666; text-align: center;">Select month and year to view summary</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Include all JavaScript modules -->
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/setup-manager.js"></script>
    <script src="js/transaction-manager.js"></script>
    <script src="js/navigation-manager.js"></script>
    <script src="js/summary-manager.js"></script>
    <script src="js/app.js"></script>
    
    <script>
    // Initialize month and year dropdowns with current date
    document.addEventListener('DOMContentLoaded', function() {
        const currentDate = new Date();
        const currentMonth = currentDate.getMonth() + 1;
        const currentYear = currentDate.getFullYear();
        
        // Set current month as selected
        const monthSelect = document.getElementById('summary-month');
        if (monthSelect) {
            monthSelect.value = currentMonth;
        }
        
        // Populate year dropdown (from 2020 to current year + 1)
        const yearSelect = document.getElementById('summary-year');
        if (yearSelect) {
            for (let year = 2020; year <= currentYear + 1; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year === currentYear) {
                    option.selected = true;
                }
                yearSelect.appendChild(option);
            }
        }
    });
    </script>
</body>
</html>